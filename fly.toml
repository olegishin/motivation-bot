# Ім'я вашого додатку на Fly.io
app = "fotinia-final"
primary_region = "fra"

[build]
  # Вказує Fly.io використовувати Dockerfile для збірки
  dockerfile = "Dockerfile"

[env]
  # URL вашого додатку для вебхука
  WEBHOOK_URL = "https://fotinia-final.fly.dev"
  # Шлях до постійного сховища всередині контейнера
  DATA_DIR = "/app/data"
  # Налаштування для коректного виводу логів Python
  PYTHONUNBUFFERED = "1"
  # Внутрішній порт, на якому працює Uvicorn
  PORT = "8080"

[http_service]
  internal_port = 8080
  force_https = true
  # Запобігає зупинці машини при неактивності
  auto_stop_machines = false
  auto_start_machines = false
  # Гарантує, що завжди працює хоча б одна машина
  min_machines_running = 1
  processes = ["web"]

  # Налаштування перевірки "здоров'я" додатку
  [[http_service.checks]]
    type = "http"
    interval = "15s"
    timeout = "2s"
    grace_period = "5s"
    method = "GET"
    path = "/"
    protocol = "http"

# Спрощений запуск через Uvicorn, без Gunicorn
[processes]
  web = "uvicorn bot:app --host 0.0.0.0 --port 8080"

# Конфігурація віртуальної машини
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 512

# Підключення постійного сховища (volume)
[mounts]
  source = "fotinia_data"
  destination = "/app/data"
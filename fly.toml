# fly.toml
# Конфигурация для Fly.io (v10.17)

# Ім'я вашого додатку на Fly.io
app = "fotinia-final"
primary_region = "fra"

[build]
  # Вказує Fly.io використовувати Dockerfile для збірки
  dockerfile = "Dockerfile"

[env]
  # --- Этот файл (v10.17) УПРОЩЕН ---
  # Секреты (TOKEN, ADMIN_ID, WEBHOOK_URL) 
  # теперь загружаются из .env через config.py
  
  # Шлях до постійного сховища всередині контейнера
  DATA_DIR = "/app/data"
  # Налаштування для коректного виводу логів Python
  PYTHONUNBUFFERED = "1"
  # Внутрішній порт, на якому працює Uvicorn
  PORT = "8080"

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = false
  auto_start_machines = false
  min_machines_running = 1
  # Этот сервис обслуживает ТОЛЬКО 'web' процесс
  processes = ["web"]

  # Налаштування перевірки "здоров'я" додатку
  [[http_service.checks]]
    type = "http"
    interval = "15s"
    timeout = "2s"
    grace_period = "5s"
    method = "GET"
    path = "/"
    protocol = "http"

# --- ⭐️ ГЛАВНОЕ ИЗМЕНЕНИЕ v10.17 ⭐️ ---
[processes]
  # Запускаем main:app изнутри папки (которую мы установили в WORKDIR)
  web = "uvicorn main:app --host 0.0.0.0 --port 8080"

# Конфігурація віртуальної машини
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 512

# --- Нужен ТОЛЬКО ОДИН ДИСК ---
# (Бэкапы теперь сохраняются в /app/data/backups)
[mounts]
  source = "fotinia_data"
  destination = "/app/data"